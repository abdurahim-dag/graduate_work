# ETL на стероидах

## Требования
- Динамические запросы, чтобы не править всё время код.
- Запустить обработку ETL.
- Остановить обработку ETL. При этом нужно обработать оставшиеся записи.
- Обновить настройки ETL-скрипта. Сюда входит любая метаинформация: название таблицы, какие поля доставать, какие события обрабатывать и другие настройки.

## Решение

### Архитектура

![](.\architecture\ETL.png)

### Логика

В рамках ETL процессов происходит, следующее:
 - выгрузка из БД источника в файлы формата json;
 - загрузка в центральный слой из json в таблицы;
 - на основе имеющейся вьюшки выгружаем в файлы формата json;
 - трансформация файлов json к необходимому формату, для загрузки в ES;
 - загрузка файлов json в ES.

Так же реализовано:
 - контроль состояния процессов экспорта из источника и файлов json из вьюшек:
 - легкий генератор запрос к источнику.

### Компоненты

 - Airflow. Планировщик ETL процессов.
 - Redis. Хранение состояния.
 - Postgres - ODS. Центральный слой сбора и хранения загружаемой информации.

### Порядок запуска проекта.

1. Старт образов - make start-all
2. Импорт данных источника - make import-movies
3. Загрузка параметров соединения в Airflow - make add-conn-all
4. Загрузка переменных в Airflow - make add-variables
5. Зайдя в интерфейс Airflow запустите даг прогрузки данных - etl-movies-dag
6. Проверьте доступность данных в источнике - curl http://localhost:9200/_cat/indices?v
